 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" 
"http://www.w3.org/TR/html4/strict.dtd"> 
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<style>
			#container {
				min-width: 300px;
				max-width: 800px;
				height: 100%;
				margin: 1em auto;
			}
		</style>
		<script src="../js/jquery.min.js"></script>
		<script src="../js/imgHcharts.js"></script>

	</head>

	<body>
		<!--
*************************************************************************
   Generated by HCODE at 2018-01-09 18:18:50
   From: https://code.hcharts.cn/jianshukeji/hhhG2T
*************************************************************************
 -->
		<div id="container"></div>

		<script>
		var Camname;
		var seriesData;
		function getStatusData(){
			$.ajax({
				//提交数据的类型 POST GET
				type: "POST",
				async: false,
				//提交的网址
				//url:"http://118.186.228.114:9999/api/Video/GetVideoRuntime?",
				url: "http://175.25.241.181:9999/api/Video/GetVideoRuntime?",
				//提交的数据
				data: {
					name: '',
					time: ''
				},
				//返回数据的格式
				datatype: "json",
				//成功返回之后调用的函数             
				success: function(data) {
					if(data) {
//						console.log(data)	
						seriesData = data.ExtraData.seriesdata;
						for(var i=0;i<seriesData.length;i++){
							seriesData[i].x = parseInt(seriesData[i].x);
							seriesData[i].x2 = parseInt(seriesData[i].x2);
						}
						Camname = data.ExtraData.ycategories;
					}
				},
				//调用出错执行的函数
				error: function() {
					//请求出错处理
					console.error()
				}
			});
		}
			
			$(function() {
				(function(H) {
					getStatusData();
					var defaultPlotOptions = H.getOptions().plotOptions,
						columnType = H.seriesTypes.column,
						each = H.each,
						extendClass = H.extendClass,
						Point = H.Point;
					defaultPlotOptions.xrange = H.merge(defaultPlotOptions.column, {
						tooltip: {
							useHTML: true,
							headerFormat: '<span>开始时间:</span>{point.x}<br/><span>结束时间:</span>{point.x2}<br/>',
							pointFormat: '<span style="color:red">\u25CF</span> 企业名称: <b>{point.yCategory}</b><br/>'
						}
					});
					H.seriesTypes.xrange = H.extendClass(columnType, {
						pointClass: extendClass(Point, {
							getLabelConfig: function() {
								var cfg = Point.prototype.getLabelConfig.call(this);
								cfg.x2 = new Date(this.x2).Format("yyyy-MM-dd hh:mm:ss");
								cfg.x = new Date(this.x).Format("yyyy-MM-dd hh:mm:ss");
								cfg.yCategory = this.yCategory = this.series.yAxis.categories && this.series.yAxis.categories[this.y];
								return cfg;
							}
						}),
						type: 'xrange',
						parallelArrays: ['x', 'x2', 'y'],
						requireSorting: false,
						animate: H.seriesTypes.line.prototype.animate,
						/**
						 * Borrow the column series metrics, but with swapped axes. This gives free access
						 * to features like groupPadding, grouping, pointWidth etc.
						 */
						getColumnMetrics: function() {
							var metrics,
								chart = this.chart;

							function swapAxes() {
								each(chart.series, function(s) {
									var xAxis = s.xAxis;
									s.xAxis = s.yAxis;
									s.yAxis = xAxis;
								});
							}
							swapAxes();
							this.yAxis.closestPointRange = 1;
							metrics = columnType.prototype.getColumnMetrics.call(this);
							swapAxes();
							return metrics;
						},
						translate: function() {
							columnType.prototype.translate.apply(this, arguments);
							var series = this,
								xAxis = series.xAxis,
								metrics = series.columnMetrics;
							H.each(series.points, function(point) {
								var barWidth = xAxis.translate(H.pick(point.x2, point.x + (point.len || 0))) - point.plotX;
								point.shapeArgs = {
									x: point.plotX,
									y: point.plotY + metrics.offset,
									width: barWidth,
									height: metrics.width
								};
								point.tooltipPos[0] += barWidth / 2;
								point.tooltipPos[1] -= metrics.width / 2;
							});
						}
					});

					H.wrap(H.Axis.prototype, 'getSeriesExtremes', function(proceed) {
						var axis = this,
							dataMax = Number.MIN_VALUE;
						proceed.call(this);
						if(this.isXAxis) {
							each(this.series, function(series) {
								each(series.x2Data || [], function(val) {
									if(val > dataMax) {
										dataMax = val;
									}
								});
							});
							if(dataMax > Number.MIN_VALUE) {
								axis.dataMax = dataMax;
							}
						}
					});
				}(Highcharts));
				Highcharts.setOptions({
					global: {
						useUTC: false
					}
				});
				// THE CHART
				$('#container').highcharts({
					chart: {
						type: 'xrange'
					},
					title: {
						text: '治理设备运行时间统计'
					},
					xAxis: {
						type: 'datetime',
						dateTimeLabelFormats: {
							second: '%H:%M:%S',
						}
					},
					yAxis: {
						title: '',
						categories: Camname,
						min: 0
					},
					series: [{
						name: '运行时间',
						borderRadius: 5,
						pointWidth: 10,
						data: seriesData
					}]
				});
			});
			Date.prototype.Format = function(fmt) {
				var o = {
					"M+": this.getMonth() + 1,
					"d+": this.getDate(),
					"h+": this.getHours(),
					"m+": this.getMinutes(),
					"s+": this.getSeconds(),
					"q+": Math.floor((this.getMonth() + 3) / 3),
					"S": this.getMilliseconds()
				};
				if(/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
				for(var k in o)
					if(new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
				return fmt;
			}
		</script>
	</body>

</html>